<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>動物将棋 - Dobutsu Shogi</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="welcome-screen" id="welcome-screen">
        <div class="welcome-content">
            <h1 class="welcome-title">動物将棋 by 長舩</h1>
            <div class="howto-link-container">
                <a href="https://shogibeya.michikusa.jp/howto_doubutu.html" target="_blank" rel="noopener noreferrer" class="howto-link">遊び方</a>
            </div>
            <div class="mode-selection" id="mode-selection">
                <button class="mode-btn" id="online-mode-btn">オンライン対戦</button>
                <button class="mode-btn" id="ai-mode-btn">コンピューター対戦</button>
            </div>
            <div class="ai-selection" id="ai-selection" style="display: none;">
                <h2 class="ai-selection-title">AIモードを選択してください</h2>
                <div class="ai-options">
                    <div class="ai-option-row">
                        <button class="ai-option-btn" data-ai-type="minimax">
                            <div class="ai-name">ミニマックス探索</div>
                            <div class="ai-description" id="minimax-desc">探索深さ: 3手（1手だと目の前の駒を取るだけですが、10手を超えると人間でも勝つのが難しくなります）</div>
                        </button>
                        <div class="ai-option-controls">
                            <button class="param-toggle-btn" data-ai-type="minimax">
                                <span>パラメータ調整</span>
                                <span class="toggle-icon">▼</span>
                            </button>
                            <div class="ai-params-inline" data-ai-type="minimax" style="display: none;">
                                <div class="param-item">
                                    <div class="param-label">探索深さ (d):</div>
                                    <input type="range" class="param-slider" id="minimax-depth" min="1" max="15" value="3" step="1">
                                    <span class="param-value-display" id="minimax-depth-display">3</span>
                                </div>
                                <div class="param-info-text">推奨範囲: 1 ～ 15手</div>
                                <button class="param-reset-btn" data-ai-type="minimax">リセット</button>
                            </div>
                        </div>
                    </div>
                    <div class="ai-option-row">
                        <button class="ai-option-btn" data-ai-type="montecarlo">
                            <div class="ai-name">モンテカルロ</div>
                            <div class="ai-description" id="montecarlo-desc">プレイアウト回数: 1000回（回数が少ないと「うっかりミス」が増え、多いと非常に堅実な指し回しになります）</div>
                        </button>
                        <div class="ai-option-controls">
                            <button class="param-toggle-btn" data-ai-type="montecarlo">
                                <span>パラメータ調整</span>
                                <span class="toggle-icon">▼</span>
                            </button>
                            <div class="ai-params-inline" data-ai-type="montecarlo" style="display: none;">
                                <div class="param-item">
                                    <div class="param-label">プレイアウト回数 (N):</div>
                                    <input type="range" class="param-slider" id="montecarlo-simulations" min="10" max="10000" value="1000" step="10">
                                    <span class="param-value-display" id="montecarlo-simulations-display">1000</span>
                                </div>
                                <div class="param-info-text">推奨範囲: 10 ～ 10,000回</div>
                                <button class="param-reset-btn" data-ai-type="montecarlo">リセット</button>
                            </div>
                        </div>
                    </div>
                    <div class="ai-option-row">
                        <button class="ai-option-btn" data-ai-type="evaluation">
                            <div class="ai-name">評価関数</div>
                            <div class="ai-description">駒の価値重みを調整（ライオンを極端に低くすると自殺願望のあるAIに、キリンを高くするとキリンを偏愛するAIになります）</div>
                        </button>
                        <div class="ai-option-controls">
                            <button class="param-toggle-btn" data-ai-type="evaluation">
                                <span>パラメータ調整</span>
                                <span class="toggle-icon">▼</span>
                            </button>
                            <div class="ai-params-inline" data-ai-type="evaluation" style="display: none;">
                                <div class="param-label">駒の価値重み:</div>
                                <div class="piece-value-controls">
                                    <div class="piece-value-item">
                                        <label>ライオン:</label>
                                        <input type="range" class="piece-value-slider" id="eval-lion-value" min="0" max="1000" value="1000" step="10">
                                        <span class="piece-value-display" id="eval-lion-display">1000</span>
                                    </div>
                                    <div class="piece-value-item">
                                        <label>にわとり:</label>
                                        <input type="range" class="piece-value-slider" id="eval-niwatori-value" min="0" max="1000" value="600" step="10">
                                        <span class="piece-value-display" id="eval-niwatori-display">600</span>
                                    </div>
                                    <div class="piece-value-item">
                                        <label>きりん:</label>
                                        <input type="range" class="piece-value-slider" id="eval-kirin-value" min="0" max="1000" value="400" step="10">
                                        <span class="piece-value-display" id="eval-kirin-display">400</span>
                                    </div>
                                    <div class="piece-value-item">
                                        <label>ぞう:</label>
                                        <input type="range" class="piece-value-slider" id="eval-zou-value" min="0" max="1000" value="400" step="10">
                                        <span class="piece-value-display" id="eval-zou-display">400</span>
                                    </div>
                                    <div class="piece-value-item">
                                        <label>ひよこ:</label>
                                        <input type="range" class="piece-value-slider" id="eval-hiyoko-value" min="0" max="1000" value="100" step="10">
                                        <span class="piece-value-display" id="eval-hiyoko-display">100</span>
                                    </div>
                                </div>
                                <div class="param-info-text">推奨範囲: 各 0 ～ 1000</div>
                                <button class="param-reset-btn" data-ai-type="evaluation">リセット</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="params-info">最大考慮時間: 5秒以内</div>
                <div class="play-examples">
                    <button class="examples-toggle-btn" id="examples-toggle-btn">
                        <span>遊び方の例</span>
                        <span class="toggle-icon">▼</span>
                    </button>
                    <div class="examples-content" id="examples-content" style="display: none;">
                        <h3>実験的な遊び方の例</h3>
                        <div class="example-item">
                            <strong>実験①：おっちょこちょいな「食いしん坊AI」</strong>
                            <div class="example-detail">
                                <div class="example-tip"><strong>設定のコツ：</strong> ミニマックス法の探索深さを「2〜3手」とあえて浅くします。</div>
                                <div class="example-highlight"><strong>見どころ：</strong> 目の前の駒を食べることに夢中で、その後の大ピンチに気づかない「うっかり感」を楽しめます。</div>
                            </div>
                        </div>
                        <div class="example-item">
                            <strong>実験②：ひよこを神と崇める「偏愛AI」</strong>
                            <div class="example-detail">
                                <div class="example-tip"><strong>設定のコツ：</strong> 評価関数の設定で、ひよこの価値を「10,000」などの異常な数値に書き換えます。</div>
                                <div class="example-highlight"><strong>見どころ：</strong> 自分のライオンが危なくても、全力でひよこを守りに行くシュールな挙動が見られます。</div>
                            </div>
                        </div>
                        <div class="example-item">
                            <strong>実験③：AIが「覚醒」する瞬間を観察する</strong>
                            <div class="example-detail">
                                <div class="example-tip"><strong>設定のコツ：</strong> パラメータ（探索深さやシミュレーション回数）を1刻みで少しずつ増やしていきます。</div>
                                <div class="example-highlight"><strong>見どころ：</strong> どの数値を超えると「急に隙がなくなるか」という、AIが知能を持つ境界線を探る実験です。</div>
                            </div>
                        </div>
                    </div>
                </div>
                <button class="ai-back-btn" id="ai-back-btn">戻る</button>
            </div>
            <p class="waiting-message" id="waiting-message"></p>
        </div>
    </div>

    <div class="container" id="game-container" style="display: none;">
        <h1>動物将棋</h1>

        <div class="game-info">
            <div class="turn-indicator">
                <span id="current-turn">先手</span>の番
            </div>
            <div class="game-controls">
                <button id="toggle-eval-btn" class="toggle-btn">評価表示: OFF</button>
                <button id="reset-btn">タイトルに戻る</button>
            </div>
        </div>
        <div class="position-evaluation" id="position-evaluation" style="display: none;">
            <div class="eval-main">
                <div class="eval-label">局面評価:</div>
                <div class="eval-value" id="eval-value">0</div>
            </div>
            <div class="eval-method-info" id="eval-method-info"></div>
        </div>
        <div class="game-layout">
            <div class="left-panel">
                <div class="captured-area opponent-captured" id="captured-opponent">
                    <div class="player-name-label" id="opponent-name">相手</div>
                    <div class="captured-label">持ち駒</div>
                    <div class="captured-pieces" id="captured-pieces-opponent"></div>
                </div>
                <div class="review-controls-panel" id="review-controls-panel" style="display: none;">
                    <button class="review-nav-btn" id="review-prev-btn">← 前の手</button>
                    <button class="review-nav-btn" id="review-next-btn">次の手 →</button>
                    <div class="review-move-info" id="review-move-info"></div>
                </div>
            </div>

            <div class="board-container">
                <div class="board" id="board"></div>
            </div>

            <div class="right-panel">
                <div class="game-record" id="game-record" style="display: none;">
                    <div class="record-header">
                        <h3>棋譜</h3>
                        <button class="record-toggle-btn" id="record-toggle-btn">折りたたむ</button>
                    </div>
                    <div class="record-content" id="record-content">
                        <div class="record-list" id="record-list"></div>
                    </div>
                </div>
                <div class="captured-area player-captured" id="captured-player">
                    <div class="player-name-label" id="player-name">あなた</div>
                    <div class="captured-label">持ち駒</div>
                    <div class="captured-pieces" id="captured-pieces-player"></div>
                </div>
            </div>
        </div>

        <div class="game-announcement" id="game-announcement"></div>

        <div class="rematch-confirmation" id="rematch-confirmation" style="display: none;">
            <div class="rematch-content">
                <p class="rematch-question">再戦しますか？</p>
                <div class="rematch-buttons">
                    <button class="rematch-btn rematch-yes" id="rematch-yes-btn">はい</button>
                    <button class="rematch-btn rematch-no" id="rematch-no-btn">いいえ</button>
                </div>
            </div>
        </div>

        <div class="review-mode" id="review-mode" style="display: none;">
            <div class="review-content">
                <h2 class="review-title">感想戦モード</h2>
                <div class="review-controls">
                    <button class="review-btn" id="review-prev-btn">← 前の手</button>
                    <span class="review-move-info" id="review-move-info">手目: 0</span>
                    <button class="review-btn" id="review-next-btn">次の手 →</button>
                </div>
                <div class="review-analysis" id="review-analysis"></div>
                <div class="review-buttons">
                    <button class="review-btn review-close" id="review-close-btn">感想戦を終了</button>
                </div>
            </div>
        </div>

        <div class="message" id="message"></div>
    </div>

    <script src="script.js"></script>
</body>

</html>